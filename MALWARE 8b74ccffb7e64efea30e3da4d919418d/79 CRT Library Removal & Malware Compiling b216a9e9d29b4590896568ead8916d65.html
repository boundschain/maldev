<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>79. CRT Library Removal &amp; Malware Compiling</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="b216a9e9-d29b-4590-8965-68ead8916d65" class="page sans"><header><h1 class="page-title"><a href="https://maldevacademy.com/modules/79"><strong>79. CRT Library Removal &amp; Malware Compiling</strong></a></h1></header><div class="page-body"><h2 id="f21faa0e-6f05-46c9-b9da-0149734a46d9" class=""><strong>CRT Library Removal &amp; Malware Compiling</strong></h2><h3 id="520f6101-585c-4b68-a082-5b3fa824ed23" class=""><strong>Introduction</strong></h3><p id="d7c935dc-8b1d-4c32-98a1-2fff700b3d75" class="">Up until this module, all of the code projects were compiled either using the <em>Release</em> or <em>Debug</em> option in Visual Studio. It is important for malware developers to understand the difference between the Release and Debug compilation options in Visual Studio, as well as the implications of changing the default compiler settings. Modifying Visual Studio&#x27;s compiler settings can have changes on the produced binary such as reducing the size or lowering entropy.</p><h3 id="b072877d-c666-4d94-a6ed-4464afe54ab3" class=""><strong>Release vs Debug Options</strong></h3><p id="f22d69a0-c9a4-44d8-8fbb-ff8b8e8da2bc" class="">Both &quot;Release&quot; and &quot;Debug&quot; build configurations determine how a program is compiled and executed with each option serving a different purpose and offering distinct features. The most important differences between the two options are shown below.</p><ul id="23b97b2f-bee8-4e86-a218-dd4c29700ac1" class="bulleted-list"><li style="list-style-type:disc"><strong>Performance</strong> - The Release build option is faster than that of the Debug. Some building optimizations are enabled in release mode that is disabled in Debug mode.</li></ul><ul id="10afb3b7-6b8f-4a70-8fe5-b070c094f071" class="bulleted-list"><li style="list-style-type:disc"><strong>Debugging</strong> - Debugging applications generated by the Debug build configuration is made easier because building optimizations are disabled in this mode, making code easier to debug. Furthermore, the Debug configuration generates Debug Symbol files (.pdb) which contain information about the source code compiled. This enables debuggers to display additional information such as variables, functions and line numbers.</li></ul><ul id="56b6e096-45e8-43ee-828d-31bb82205e22" class="bulleted-list"><li style="list-style-type:disc"><strong>Deployment</strong> - The Release version of the application is deployed to users due to its increased compatibility with their machines, unlike the Debug version, which typically requires additional dynamic link libraries (DLLs) that are only available with Visual Studio, thus making Debug applications compatible only with machines that have Visual Studio installed.</li></ul><ul id="c74e5df6-fe28-4847-9eb2-4e4db3a00174" class="bulleted-list"><li style="list-style-type:disc"><strong>Exception handling</strong> - In Debug build configuration, Visual Studio can pause execution and show an error message as a message box when an exception is thrown, specifying the variable&#x27;s name or line number that caused the stack corruption, for example. Such exceptions may cause the program to crash if compiled in Release mode.</li></ul><h3 id="63422cf6-be9b-4c6f-a130-aa80872df626" class=""><strong>Default Compiler Settings</strong></h3><p id="15631bd9-8dd6-4573-bfbe-1dbbecda0665" class="">Based on the previous points, the Release option is favorable over the Debug option. With that said, the Release option still has several problems.</p><ul id="9355c85f-44b8-4293-b6d0-f4f065f74424" class="bulleted-list"><li style="list-style-type:disc"><strong>Compatibility</strong> - Some applications using the Release option can still result in errors similar to the one below if the target machine does not have Visual Studio installed.</li></ul><p id="4a473350-9f8e-4732-a17f-cc6440072a6e" class="">
</p><figure id="84af0895-3b5a-457a-87c8-5b200d158e4d" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-116939162-63627c0c-8e3c-4a1f-a7f3-0b2450c9e7dc.png"><img style="width:921px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-116939162-63627c0c-8e3c-4a1f-a7f3-0b2450c9e7dc.png"/></a></figure><p id="f7ec46be-343c-4032-804e-32ac480394e7" class="">• <strong>CRT Imported Functions</strong> - Several unresolved functions are present in the IAT which cannot be resolved using approaches such as API Hashing. These functions are imported from the CRT library, which will be explained later. For now, it is sufficient to understand that there are several unused imported functions in any application generated by Visual Studio&#x27;s default compiler settings. As an example, the IAT of a &#x27;Hello World&#x27; program should only import information regarding the <code>printf</code> function, however, it is importing the following functions (output is truncated due to the size).</p><figure id="14f382a9-a917-4c86-aab7-5defbcdacd92" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-216062571-e46c5ade-4aa5-4d7f-8d8a-5562af6a5229.png"><img style="width:1507px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-216062571-e46c5ade-4aa5-4d7f-8d8a-5562af6a5229.png"/></a></figure><p id="e5d81a02-f57e-4b05-a9de-0db49589ea57" class="">• <strong>Size</strong> - The generated files are often bigger than they should be due to the default compiler optimizations. For example, the following <code>Hello World</code> program is around 11kb.</p><figure id="dfeb9e37-441a-430c-9f53-076194b693af" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-416058406-95d621d1-1329-47b2-8750-ebbcef912dc8.png"><img style="width:1319px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-416058406-95d621d1-1329-47b2-8750-ebbcef912dc8.png"/></a></figure><p id="e177ab14-ca6d-4e48-9eb1-ab142673ea02" class="">• <strong>Debugging Information</strong> - Using the Release option can still include debugging-related information and other strings that can be used by security solutions to create static signatures. The images below show the output of executing <code>Strings.exe</code> on the <code>Hello World</code> program (output is truncated due to the size).</p><figure id="12ae7fee-5932-4d6f-83b5-6f7c33abb87e" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-716065105-1ba22df8-af64-483a-8a38-803b75bb4ae4.png"><img style="width:1316px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-716065105-1ba22df8-af64-483a-8a38-803b75bb4ae4.png"/></a></figure><h3 id="54ae91cd-97e8-4568-bd30-035cfe238fc4" class=""><strong>The CRT library</strong></h3><p id="86460938-0417-4c6e-a491-8bd1642e33dd" class="">The CRT library, also known as the <em>Microsoft C Run-Time Library</em>, is a set of low-level functions and macros that provide a foundation for standard C and C++ programs. It includes functions for memory management (e.g. <code>malloc</code>, <code>memset</code> and <code>free</code>), string manipulation (e.g. <code>strcpy</code> and <code>strlen</code>) and I/O functions (e.g. <code>printf</code>, <code>wprintf</code> and <code>scanf</code>).</p><p id="ef4b118e-2419-4459-b876-eca27d046a03" class="">The CRT library DLLs are named <code>vcruntimeXXX.dll</code> where XXX is the version number of the CRT library used. There are also DLLs such as <code>api-ms-win-crt-stdio-l1-1-0.dll</code>, <code>api-ms-win-crt-runtime-l1-1-0.dll</code> and <code>api-ms-win-crt-locale-l1-1-0.dll</code> that are also related to the CRT library. Each DLL serves a particular purpose and exports several functions. These DLLs are linked by the compiler at compile time and therefore are found in the IAT of the generated programs.</p><h3 id="5e42b430-4e60-4bee-b555-bd2522051182" class=""><strong>Solving Compatibility Issues</strong></h3><p id="e6cb4e01-0c04-4f51-89e9-c38a90007af3" class="">By default, when compiling an application, the <em>Runtime Library</em> option in Visual Studio is set to &quot;Multi-threaded DLL (/MD)&quot;. With this option, the CRT Library DLLs are linked dynamically which means they are loaded at runtime. This creates the compatibility issues previously mentioned. To solve these issues, set the Runtime Library option to &quot;Multi-threaded (/MT)&quot;, as shown below.</p><figure id="03f5838d-ff69-4e09-b7ad-2240849964ef" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-816073627-98d49140-e86d-4622-88c8-a40f9a9db79c.png"><img style="width:1104px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-816073627-98d49140-e86d-4622-88c8-a40f9a9db79c.png"/></a></figure><h3 id="51c71cf9-fc92-4763-ac26-4a154e0f76e6" class=""><strong>Multi-threaded (/MT)</strong></h3><p id="612edf63-0d63-4709-944f-a9f28f83ab26" class="">The Visual Studio compiler can be made to link CRT functions statically by selecting the &quot;Multi-threaded (/MT)&quot; option. This results in functions such as <code>printf</code> being directly represented in the generated program, rather than imported from CRT library DLLs. Note that this will increase the size of the final binary and adds more WinAPIs to the IAT, although it removes the CRT library DLLs.</p><p id="4b55b469-9f64-4b6e-85ba-58edf8078f86" class="">Using the &quot;Multi-threaded (/MT)&quot; option to compile the <code>Hello World</code> program results in the following IAT.</p><figure id="d2b89161-b57d-47fd-8b37-40e37670cf82" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-916075724-73b3ba91-3a72-4f93-9dd8-0ee03cd3fe2d.png"><img style="width:1508px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-916075724-73b3ba91-3a72-4f93-9dd8-0ee03cd3fe2d.png"/></a></figure><p id="f409656c-60ca-4d33-990a-40007167e079" class="">The binary becomes considerably larger as well, as shown below.</p><figure id="f630f40f-c10a-4fd1-909a-a43feba1d61b" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-11.png"><img style="width:1212px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-11.png"/></a></figure><h3 id="1925a6a9-0496-4ebc-a09d-40c988fe6d62" class=""><strong>CRT Library &amp; Debugging</strong></h3><p id="6aa30a23-a58d-4907-a9a9-a2cec3ab742d" class="">After removing the CRT Library, the program can only be compiled in Release mode. This makes it more difficult to debug the code. Therefore, it is recommended that the removal of the CRT Library is only done after debugging and development are complete.</p><h3 id="34724cb8-2eac-4771-8db5-34fef9234d20" class=""><strong>Additional Compiler Changes</strong></h3><p id="cce8e881-65c2-49fa-be43-092f431dd986" class="">The previous sections demonstrated how to statically link the CRT library. However, the ideal solution would be to avoid relying on the CRT library both statically and dynamically, as this can lead to a reduction in the binary size, as well as the removal of unnecessary imported functions and debug information. To accomplish this, several Visual Studio compilation options must be modified.</p><h3 id="85bdd77a-d4ce-4527-944f-2ef78844f423" class=""><strong>Disable C++ Exceptions</strong></h3><p id="c2e2bf15-7d7b-4e18-8313-9082e28aba85" class="">The <em>Enable C++ Exceptions</em> option is used to generate code to correctly propagate exceptions thrown by the code, however, as the CRT Library is no longer linked, this option is not necessary and should be disabled.</p><figure id="eb13f452-e8be-4110-93fc-775a3cc9fbf4" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-12.png"><img style="width:1199px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-12.png"/></a></figure><h3 id="52eaa15e-c98f-4611-a18a-981ae196b3d1" class=""><strong>Disable Whole Program Optimization</strong></h3><p id="fe7d04d7-4341-4bec-9e87-426fe6e90a18" class="">The <em>Whole Program Optimization</em> should be disabled to prevent the compiler from performing optimizations that may affect the stack. Disabling this option provides complete control over the compiled code.</p><p id="1bcaa951-059f-4a88-8bd8-4ab2c37e2283" class="">
</p><p id="4cbf5eb7-7e81-4d61-9591-670bd94483f4" class="">
</p><figure id="102eae57-b264-47d2-9cac-9d27eb758273" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-13.png"><img style="width:1178px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-13.png"/></a></figure><h3 id="2a2afe87-155b-4db2-9177-2d5b78d67be8" class=""><strong>Disable Debug Info</strong></h3><p id="ff9894c3-e94e-4b09-811b-e126a6d256f9" class="">Disable the <em>Generate Debug Info</em> and <em>Generate Manifest</em> options to remove the added debugging information.</p><figure id="d6fcde58-c013-458a-ad84-c59a48363d86" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-14.png"><img style="width:1152px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-14.png"/></a></figure><figure id="6afd21bc-105b-445b-a583-936d4c80e6f1" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-15.png"><img style="width:1264px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-15.png"/></a></figure><h3 id="523bbf19-4aab-4761-afa4-5810fbfe08c2" class=""><strong>Ignore All Default Libraries</strong></h3><p id="fec96ce1-9f85-4ea5-940d-c0cc1fce2e3a" class="">Set the <em>Ignore All Default Libraries</em> option to &quot;Yes (/NODEFAULTLIB)&quot; to exclude the default system libraries from being linked by the compiler with the program. This will result in the exclusion of the linking of the CRT Library as well as other libraries. In this case, it is the responsibility of the user to provide any required functions that are usually provided by these default libraries. The image below shows the &quot;Yes (/NODEFAULTLIB)&quot; option being set.</p><figure id="3b80b4a1-8ee1-4c1f-813a-9a05250e5598" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-16.png"><img style="width:1181px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-16.png"/></a></figure><p id="7b7ba2a2-0a7f-42be-8243-15bc1c8604e5" class="">Unfortunately, compiling with that option results in several errors, as shown below.</p><figure id="95e56258-2c76-4f38-9f8f-e32ae94d0004" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-17.png"><img style="width:971px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-17.png"/></a></figure><h3 id="c3b3304a-6184-46fe-99e9-ed96ee463beb" class=""><strong>Setting Entry Point Symbol</strong></h3><p id="aea11629-21af-4e2e-9bba-7b6a36f10fae" class="">The first error &quot;LNK2001 - unresolved external symbol mainCRTStartup&quot; implies that the compiler was unable to locate the definition for the &quot;mainCRTStartup&quot; symbol. This is expected as &quot;mainCRTStartup&quot; is the entry point for a program that has been linked with the CRT Library, which is not the case here. To resolve this issue, a new entry point symbol should be set as shown below.</p><figure id="ed7bce23-8714-4df0-980d-12be49b0ae70" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-18.png"><img style="width:1150px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-18.png"/></a></figure><figure id="c824f9ff-1364-453f-a4c8-c45262d2bf39" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-19.png"><img style="width:1140px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-19.png"/></a></figure><p id="8e613ce6-f7e7-4565-915c-a041ce812deb" class="">The entry &quot;main&quot; represents the main function in the source code. To choose a different function as an entry point, simply set the entry point symbol to that function&#x27;s name. Recompiling results in fewer errors, as shown below.</p><figure id="523ae4df-68d9-4b0f-97fc-0faec47fb287" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-20.png"><img style="width:919px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-20.png"/></a></figure><h3 id="3e8914c4-5e63-4774-a7fb-cef99309288a" class=""><strong>Disable Security Check</strong></h3><p id="e484c2a2-4f65-47eb-97ca-a3a2c2b13159" class="">The next error, &quot;LNK2001 - unresolved external symbol __security_check_cookie&quot;, means that the &quot;__security_check_cookie&quot; symbol was not found by the compiler. This is a symbol that is used to perform a stack cookie check which is a security feature that helps in preventing stack buffer overflows. To solve this, set the <em>Security Check</em> option to &quot;Disable Security Check (/Gs-)&quot; as shown below.</p><figure id="9204533c-3c3d-4e46-97ad-b68483aa5ad2" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-21.png"><img style="width:1180px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-21.png"/></a></figure><h3 id="79a7eaba-c2f4-4b60-9163-2a7761650f44" class=""><strong>Disable SDL Checks</strong></h3><p id="524c4307-1c6d-42a7-8dcf-d8101f9e7371" class="">Once the security check is disabled, the error disappears but a new warning shows up.</p><figure id="6429876f-5783-4a23-980f-8b8c0ed03247" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-22.png"><img style="width:1019px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-22.png"/></a></figure><p id="d73d0816-88dd-4722-8e0c-94c88d2097e7" class="">The &quot;D9025 - overriding &#x27;/sdl&#x27; with &#x27;/GS-&#x27;&quot; warning can be resolved by disabling the <a href="https://learn.microsoft.com/en-us/cpp/build/reference/sdl-enable-additional-security-checks?view=msvc-170">Security Development Lifecycle (SDL) checks</a>.</p><figure id="34a33cfa-8f3d-4795-8483-4383ee8b4518" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-23.png"><img style="width:1166px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-23.png"/></a></figure><p id="a85e58b3-a291-4354-9f2c-6bbdbbc6f137" class="">Two unresolved symbol errors remain, which are resolved in the <em>Functions Replacement</em> section below.</p><figure id="5f86a193-891f-489a-b21d-7ec21b0214e5" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-24.png"><img style="width:1054px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-24.png"/></a></figure><h3 id="8b781675-ca63-46a5-a873-569fd111a181" class=""><strong>Replacing CRT Library Functions</strong></h3><p id="c094cdc3-ba50-45fc-9831-f02d089bfbee" class="">Two errors remain unresolved due to the removal of the CRT Library. The <code>printf</code> function is currently being used to print to the console, although the CRT Library has been removed from the program.</p><p id="4d1965c1-f34d-49c1-bc3c-f97117db70ff" class="">When removing the CRT Library, writing one&#x27;s own version of functions such as <code>printf</code>, <code>strlen</code>, <code>strcat</code>, <code>memcpy</code> is necessary. Libraries like <a href="https://github.com/vxunderground/VX-API">VX-API</a> may be used for this purpose. For example, <a href="https://github.com/vxunderground/VX-API/blob/main/VX-API/StringCompare.cpp">StringCompare.cpp</a> replaces the <code>strcmp</code> function for string comparison.</p><h3 id="b95a1530-ef91-4a7f-ab7c-14e2a5efedf1" class=""><strong>Replacing Printf</strong></h3><p id="4018b06c-b14b-40b6-8aa3-081696c6bcc1" class="">For the demo program used in this module, the <code>printf</code> function is replaced with the following macro.</p><pre id="91565c42-856e-4a5b-a785-1e0ecd2d67c5" class="code code-wrap"><code>#define PRINTA( STR, ... )                                                                  \
    if (1) {                                                                                \
        LPSTR buf = (LPSTR)HeapAlloc( GetProcessHeap(), HEAP_ZERO_MEMORY, 1024 );           \
        if ( buf != NULL ) {                                                                \
            int len = wsprintfA( buf, STR, __VA_ARGS__ );                                   \
            WriteConsoleA( GetStdHandle( STD_OUTPUT_HANDLE ), buf, len, NULL, NULL );       \
            HeapFree( GetProcessHeap(), 0, buf );                                           \
        }                                                                                   \
    }</code></pre><p id="045f8935-640d-456a-8ca1-145d233251bf" class="">The <code>PRINTA</code> macro takes two arguments:</p><ul id="84e30c3f-a1c4-42ed-8566-198ef2e9de2c" class="bulleted-list"><li style="list-style-type:disc"><code>STR</code> - The format string which represents how to print the output.</li></ul><ul id="1d581025-fbfa-4b96-8765-c11b461b7e4a" class="bulleted-list"><li style="list-style-type:disc"><code>__VA_ARGS__</code> or <code>...</code> - Which are the arguments to be printed.</li></ul><p id="d8c5c6ad-c479-43c0-b6ed-4ac30a075e48" class="">The <code>PRINTA</code> macro allocates a heap buffer of size 1024 bytes, then uses the <a href="https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-wsprintfa">wsprintfA</a> function to write formatted data from the variable arguments (<code>__VA_ARGS__</code>) into the buffer using the format string (<code>STR</code>). Subsequently, the <a href="https://learn.microsoft.com/en-us/windows/console/writeconsole">WriteConsoleA</a> WinAPI is used to write the resulting string to the console, which is obtained via the <a href="https://learn.microsoft.com/en-us/windows/console/getstdhandle">GetStdHandle</a> WinAPI.</p><p id="de6160d2-003c-4fe7-965f-745f61154fa8" class="">Replacing <code>printf</code> with <code>PRINTA</code> results in the <code>Hello World</code> program that is independent of the CRT Library. This code resolves any remaining errors and can now compile successfully.</p><pre id="6bad860b-2ce4-48ec-9340-da4a97918475" class="code code-wrap"><code>#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;#define PRINTA( STR, ... )                                                                  \
    if (1) {                                                                                \
        LPSTR buf = (LPSTR)HeapAlloc( GetProcessHeap(), HEAP_ZERO_MEMORY, 1024 );           \
        if ( buf != NULL ) {                                                                \
            int len = wsprintfA( buf, STR, __VA_ARGS__ );                                   \
            WriteConsoleA( GetStdHandle( STD_OUTPUT_HANDLE ), buf, len, NULL, NULL );       \
            HeapFree( GetProcessHeap(), 0, buf );                                           \
        }                                                                                   \
    }  int main() {
   PRINTA(&quot;Hello World ! \n&quot;);
   return 0;

}
</code></pre><h3 id="d1dd8d82-8e2a-432d-8185-4fea9a508315" class=""><strong>Building a CRT Library Independent Malware</strong></h3><p id="4018d27e-9fbd-4f88-bca0-1c35a7763f0e" class="">When building malware that does not utilize the CRT Library, there are a few items to take note of.</p><h3 id="7006eca3-9e39-4fdd-8f30-ff053d3c7682" class=""><strong>Intrinsic Function Usage</strong></h3><p id="18c41476-88b9-4c3f-ad74-2e92e70bf2ae" class="">Some functions and macros in Visual Studio use CRT functions to perform their tasks. For example, the <code>ZeroMemory</code> macro uses the CRT function <code>memset</code> to populate the specified buffer with zeros. This requires the developer to find an alternative to that macro since it cannot be used. In this case, the <a href="https://github.com/vxunderground/VX-API/blob/main/VX-API/CopyMemoryEx.cpp">CopyMemoryEx.cpp</a> function can be used as a replacement.</p><p id="4ab5725b-653f-4bbc-b1fe-e321fb7577c0" class="">Another solution would be manually setting custom versions of CRT-based functions like <code>memset</code>. Forcing the compiler to deal with this custom function instead of using the CRT exported version. Sequentially, macros like <code>ZeroMemory</code> will also use this custom function.</p><p id="ecf13901-253b-40b3-a7c6-0e6c1ddc8d92" class="">To demonstrate this, a custom version of the <code>memset</code> function can be specified to the compiler in the following manner, using the <code>intrinsic</code> keyword.</p><pre id="905b83f6-ea4b-45fc-85c3-6fc6379b16d4" class="code code-wrap"><code>#include &lt;Windows.h&gt;// The `extern` keyword sets the `memset` function as an external function.
extern void* __cdecl memset(void*, int, size_t);

// The `#pragma intrinsic(memset)` and #pragma function(memset) macros are Microsoft-specific compiler instructions.
// They force the compiler to generate code for the memset function using a built-in intrinsic function.
#pragma intrinsic(memset)#pragma function(memset)void* __cdecl memset(void* Destination, int Value, size_t Size) {
	// logic similar to memset&#x27;s one
	unsigned char* p = (unsigned char*)Destination;
	while (Size &gt; 0) {
		*p = (unsigned char)Value;
		p++;
		Size--;
	}
	return Destination;
}


int main() {

	PVOID pBuff = HeapAlloc(GetProcessHeap(), 0, 0x100);
	if (pBuff == NULL)
		return -1;

    // this will use our version of &#x27;memset&#x27; instead of CRT&#x27;s Library version
	ZeroMemory(pBuff, 0x100);

	HeapFree(GetProcessHeap(), 0, pBuff);

	return 0;
}
</code></pre><h3 id="31ec8f3c-beaf-4f25-b0f3-f364a737bc26" class=""><strong>Hiding The Console Window</strong></h3><p id="9f4c74d0-ffd0-4eb5-b402-d8bd8786271f" class="">Malware should not spawn a console window when executed, as this is highly suspicious and allows the user to terminate the program by closing the window. To prevent this, <a href="https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-showwindow">ShowWindow(NULL, SW_HIDE)</a> can be used at the start of the entry point function, though this requires time (in milliseconds) and can cause a noticeable <em>flash</em>.</p><p id="96e3e149-f64c-468f-bebd-0ca071a46298" class="">A better solution is to set the program to be compiled as a GUI program by setting the Visual Studio <em>SubSystem</em> option to &quot;Windows (/SUBSYSTEM:WINDOWS)&quot;.</p><figure id="4146d035-8e18-4dbb-b29e-1f46c48d4166" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-25.png"><img style="width:1211px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-25.png"/></a></figure><h3 id="b21e74c5-ac42-42cf-9ce3-e2f70d7dc8fb" class=""><strong>Demo</strong></h3><p id="5c88c41b-4fbf-43f4-a4ac-a9014dac7394" class="">After performing all the steps explained in this module, the results are shown.</p><p id="6a4e2610-fa86-421c-92d5-575b97cc7f23" class="">First, the binary size is reduced from 112.5kb to approximately 3kb.</p><p id="8838ef1e-bcef-414a-88e7-28028ee562b9" class="">
</p><figure id="b1ebfc08-e2e9-4d3e-99da-53c84696055d" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-26.png"><img style="width:1286px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-26.png"/></a></figure><p id="0141022d-fdb5-4da2-8b30-61a6c7ae66bb" class="">Next, no unused functions are found in the IAT.</p><figure id="3a1d35a1-1c99-4184-8d5d-fa3b0fdfdf13" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-27.png"><img style="width:1145px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-27.png"/></a></figure><p id="9bb519fd-8f9a-41c9-85d0-79f2fb9df66e" class="">Fewer strings are found in the binary with no debug information.</p><figure id="cda294bc-fd41-433e-865e-02fffa69e578" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-28.png"><img style="width:1389px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-28.png"/></a></figure><p id="1294846c-262c-4159-be1a-1eb46a0cc7f4" class="">Finally, the removal of the CRT Library results in better evasion. The binary is uploaded to VirusTotal twice, the first time it is using the &quot;Multi-threaded (/MT)&quot; option to statically link the CRT library. The second time is when the CRT Library was completely removed.</p><figure id="a943e550-4c53-40f1-ba6e-b5bd105c9e22" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-29.png"><img style="width:913px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-29.png"/></a></figure><figure id="6134a344-7658-4e78-81c5-74a69553298a" class="image"><a href="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-30.png"><img style="width:911px" src="79%20CRT%20Library%20Removal%20&amp;%20Malware%20Compiling%20b216a9e9d29b4590896568ead8916d65/crt-30.png"/></a></figure></div></article></body></html>